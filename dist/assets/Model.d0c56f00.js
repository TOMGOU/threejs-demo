import{f as $,w as ye,g as we,h as ge,r as be,o as _e,c as xe,j as ee,v as te,k as ne,a as ve,l as ke,m as Se,n as Le}from"./vendor.71f43189.js";import{L as le,F as z,B as Ce,a as se,V as q,Q as De,O as Te,M as ce,S as Pe,T as de,b as Ae,c as Ee,C as Me,d as he,e as V,G as B,f as Ie,D as Re,g as Oe,R as Be,h as Ne,i as Fe,A as Ge,j as oe,k as Ue,P as We,l as He,W as ze,m as je}from"./three.module.4e473ec6.js";import{p as qe}from"./photo-sphere-viewer.adb51acf.js";import{G as Ve,O as Ye}from"./GLTFLoader.1dc520eb.js";import{_ as Ze}from"./index.1fdf3492.js";const H=new WeakMap;class Je extends le{constructor(e){super(e);this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,c,r){const i=new z(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,s=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(s,a).then(n).catch(r)},c,r)}decodeDracoFile(e,n,c,r){const i={attributeIDs:c||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!c};this.decodeGeometry(e,i).then(n)}decodeGeometry(e,n){for(const d in n.attributeTypes){const h=n.attributeTypes[d];h.BYTES_PER_ELEMENT!==void 0&&(n.attributeTypes[d]=h.name)}const c=JSON.stringify(n);if(H.has(e)){const d=H.get(e);if(d.key===c)return d.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const i=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(i,s).then(d=>(r=d,new Promise((h,o)=>{r._callbacks[i]={resolve:h,reject:o},r.postMessage({type:"decode",id:i,taskConfig:n,buffer:e},[e])}))).then(d=>this._createGeometry(d.geometry));return a.catch(()=>!0).then(()=>{r&&i&&this._releaseTask(r,i)}),H.set(e,{key:c,promise:a}),a}_createGeometry(e){const n=new Ce;e.index&&n.setIndex(new se(e.index.array,1));for(let c=0;c<e.attributes.length;c++){const r=e.attributes[c],i=r.name,s=r.array,a=r.itemSize;n.setAttribute(i,new se(s,a))}return n}_loadLibrary(e,n){const c=new z(this.manager);return c.setPath(this.decoderPath),c.setResponseType(n),c.setWithCredentials(this.withCredentials),new Promise((r,i)=>{c.load(e,r,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(c=>{const r=c[0];e||(this.decoderConfig.wasmBinary=c[1]);const i=Ke.toString(),s=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(i){const s=i.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,i){return r._taskLoad>i._taskLoad?-1:1});const c=this.workerPool[this.workerPool.length-1];return c._taskCosts[e]=n,c._taskLoad+=n,c})}_releaseTask(e,n){e._taskLoad-=e._taskCosts[n],delete e._callbacks[n],delete e._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function Ke(){let y,e;onmessage=function(s){const a=s.data;switch(a.type){case"init":y=a.decoderConfig,e=new Promise(function(o){y.onModuleLoaded=function(m){o({draco:m})},DracoDecoderModule(y)});break;case"decode":const d=a.buffer,h=a.taskConfig;e.then(o=>{const m=o.draco,u=new m.Decoder,w=new m.DecoderBuffer;w.Init(new Int8Array(d),d.byteLength);try{const l=n(m,u,w,h),t=l.attributes.map(p=>p.array.buffer);l.index&&t.push(l.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:l},t)}catch(l){console.error(l),self.postMessage({type:"error",id:a.id,error:l.message})}finally{m.destroy(w),m.destroy(u)}});break}};function n(s,a,d,h){const o=h.attributeIDs,m=h.attributeTypes;let u,w;const l=a.GetEncodedGeometryType(d);if(l===s.TRIANGULAR_MESH)u=new s.Mesh,w=a.DecodeBufferToMesh(d,u);else if(l===s.POINT_CLOUD)u=new s.PointCloud,w=a.DecodeBufferToPointCloud(d,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!w.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+w.error_msg());const t={index:null,attributes:[]};for(const p in o){const _=self[m[p]];let g,b;if(h.useUniqueIDs)b=o[p],g=a.GetAttributeByUniqueId(u,b);else{if(b=a.GetAttributeId(u,s[o[p]]),b===-1)continue;g=a.GetAttribute(u,b)}t.attributes.push(r(s,a,u,p,_,g))}return l===s.TRIANGULAR_MESH&&(t.index=c(s,a,u)),s.destroy(u),t}function c(s,a,d){const o=d.num_faces()*3,m=o*4,u=s._malloc(m);a.GetTrianglesUInt32Array(d,m,u);const w=new Uint32Array(s.HEAPF32.buffer,u,o).slice();return s._free(u),{array:w,itemSize:1}}function r(s,a,d,h,o,m){const u=m.num_components(),l=d.num_points()*u,t=l*o.BYTES_PER_ELEMENT,p=i(s,o),_=s._malloc(t);a.GetAttributeDataArrayForAllPoints(d,m,p,t,_);const g=new o(s.HEAPF32.buffer,_,l).slice();return s._free(_),{name:h,array:g,itemSize:u}}function i(s,a){switch(a){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32}}}const re=new q,Qe=new De,ie=new q;class N extends Te{constructor(e=document.createElement("div")){super();this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(n){n.element instanceof Element&&n.element.parentNode!==null&&n.element.parentNode.removeChild(n.element)})})}copy(e,n){return super.copy(e,n),this.element=e.element.cloneNode(!0),this}}N.prototype.isCSS3DObject=!0;class Xe extends N{constructor(e){super(e);this.rotation2D=0}copy(e,n){return super.copy(e,n),this.rotation2D=e.rotation2D,this}}Xe.prototype.isCSS3DSprite=!0;const S=new ce,$e=new ce;class et{constructor(e={}){const n=this;let c,r,i,s;const a={camera:{fov:0,style:""},objects:new WeakMap},d=e.element!==void 0?e.element:document.createElement("div");d.style.overflow="hidden",this.domElement=d;const h=document.createElement("div");h.style.transformStyle="preserve-3d",h.style.pointerEvents="none",d.appendChild(h),this.getSize=function(){return{width:c,height:r}},this.render=function(l,t){const p=t.projectionMatrix.elements[5]*s;a.camera.fov!==p&&(d.style.perspective=t.isPerspectiveCamera?p+"px":"",a.camera.fov=p),l.autoUpdate===!0&&l.updateMatrixWorld(),t.parent===null&&t.updateMatrixWorld();let _,g;t.isOrthographicCamera&&(_=-(t.right+t.left)/2,g=(t.top+t.bottom)/2);const k=(t.isOrthographicCamera?"scale("+p+")translate("+o(_)+"px,"+o(g)+"px)"+m(t.matrixWorldInverse):"translateZ("+p+"px)"+m(t.matrixWorldInverse))+"translate("+i+"px,"+s+"px)";a.camera.style!==k&&(h.style.transform=k,a.camera.style=k),w(l,l,t)},this.setSize=function(l,t){c=l,r=t,i=c/2,s=r/2,d.style.width=l+"px",d.style.height=t+"px",h.style.width=l+"px",h.style.height=t+"px"};function o(l){return Math.abs(l)<1e-10?0:l}function m(l){const t=l.elements;return"matrix3d("+o(t[0])+","+o(-t[1])+","+o(t[2])+","+o(t[3])+","+o(t[4])+","+o(-t[5])+","+o(t[6])+","+o(t[7])+","+o(t[8])+","+o(-t[9])+","+o(t[10])+","+o(t[11])+","+o(t[12])+","+o(-t[13])+","+o(t[14])+","+o(t[15])+")"}function u(l){const t=l.elements,p="matrix3d("+o(t[0])+","+o(t[1])+","+o(t[2])+","+o(t[3])+","+o(-t[4])+","+o(-t[5])+","+o(-t[6])+","+o(-t[7])+","+o(t[8])+","+o(t[9])+","+o(t[10])+","+o(t[11])+","+o(t[12])+","+o(t[13])+","+o(t[14])+","+o(t[15])+")";return"translate(-50%,-50%)"+p}function w(l,t,p,_){if(l.isCSS3DObject){const g=l.visible===!0&&l.layers.test(p.layers)===!0;if(l.element.style.display=g===!0?"":"none",g===!0){l.onBeforeRender(n,t,p);let b;l.isCSS3DSprite?(S.copy(p.matrixWorldInverse),S.transpose(),l.rotation2D!==0&&S.multiply($e.makeRotationZ(l.rotation2D)),l.matrixWorld.decompose(re,Qe,ie),S.setPosition(re),S.scale(ie),S.elements[3]=0,S.elements[7]=0,S.elements[11]=0,S.elements[15]=1,b=u(S)):b=u(l.matrixWorld);const k=l.element,E=a.objects.get(l);if(E===void 0||E.style!==b){k.style.transform=b;const I={style:b};a.objects.set(l,I)}k.parentNode!==h&&h.appendChild(k),l.onAfterRender(n,t,p)}}for(let g=0,b=l.children.length;g<b;g++)w(l.children[g],t,p)}}}function ae(y){const e=new Pe({map:new de().load("./mark/light-point.png"),transparent:!0}),n=new Ae(e);n.scale.set(30,30,1);const c=new q;return y.getWorldPosition(c),n.position.copy(c),n}class tt extends le{constructor(e){super(e)}load(e,n,c,r){const i=this,s=new z(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,function(a){let d;try{d=JSON.parse(a)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),d=JSON.parse(a.substring(65,a.length-2))}const h=i.parse(d);n&&n(h)},c,r)}parse(e){return new pe(e)}}class pe{constructor(e){this.type="Font",this.data=e}generateShapes(e,n=100){const c=[],r=nt(e,n,this.data);for(let i=0,s=r.length;i<s;i++)Array.prototype.push.apply(c,r[i].toShapes());return c}}function nt(y,e,n){const c=Array.from(y),r=e/n.resolution,i=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,s=[];let a=0,d=0;for(let h=0;h<c.length;h++){const o=c[h];if(o===`
`)a=0,d-=i;else{const m=st(o,r,a,d,n);a+=m.offsetX,s.push(m.path)}}return s}function st(y,e,n,c,r){const i=r.glyphs[y]||r.glyphs["?"];if(!i){console.error('THREE.Font: character "'+y+'" does not exists in font family '+r.familyName+".");return}const s=new Ee;let a,d,h,o,m,u,w,l;if(i.o){const t=i._cachedOutline||(i._cachedOutline=i.o.split(" "));for(let p=0,_=t.length;p<_;)switch(t[p++]){case"m":a=t[p++]*e+n,d=t[p++]*e+c,s.moveTo(a,d);break;case"l":a=t[p++]*e+n,d=t[p++]*e+c,s.lineTo(a,d);break;case"q":h=t[p++]*e+n,o=t[p++]*e+c,m=t[p++]*e+n,u=t[p++]*e+c,s.quadraticCurveTo(m,u,h,o);break;case"b":h=t[p++]*e+n,o=t[p++]*e+c,m=t[p++]*e+n,u=t[p++]*e+c,w=t[p++]*e+n,l=t[p++]*e+c,s.bezierCurveTo(m,u,w,l,h,o);break}}return{offsetX:i.ha*e,path:s}}pe.prototype.isFont=!0;const j=250,ot=new Me(j,j,10,128),rt=new he({color:4372867}),ue=new V(ot,rt);ue.translateY(-5);const Y=new B;Y.add(ue);const it=new tt;it.load("./font/helvetiker_bold.typeface.json",y=>{const e=new Ie({color:16777215,side:Re}),n=y.generateShapes("LEXUS UX300E",30),c=new Oe(n),r=new V(c,e);r.position.z=j,r.position.x=-120,Y.add(r)});const at={id:"BYD"},lt=Se('<div class="mark" data-v-cd93a212><div class="des" data-v-cd93a212><div class="title" data-v-cd93a212>\u524D\u8138\u8BBE\u8BA1</div><div class="text" data-v-cd93a212>\u524D\u8138\u7EBA\u9524\u5F0F\u7684\u4E2D\u7F51\u683C\u6805\u8BBE\u8BA1</div><div class="text" data-v-cd93a212>\u642D\u914D\u4E24\u4FA7\u72ED\u957F\u7280\u5229\u7684\u5927\u706F\u9020\u578B</div></div></div><div class="mark" data-v-cd93a212><div class="des" data-v-cd93a212><div class="text" data-v-cd93a212>\u5168\u65B0\u6DF7\u52A8\u79D1\u6280\uFF0CFYRA\u56DB\u9A71\u52A8\u529B\u7CFB\u7EDF</div></div></div>',2),ct={id:"car"},dt={id:"photosphere"},ht=Le("\u5207\u6362"),pt={setup(y){const e=$(100),n=$(!1);ye(n,r=>{const i=document.getElementsByClassName("mark");for(let s=0;s<i.length;s++)i[s].style.visibility=r?"visible":"hidden"});const c=()=>{n.value=!n.value};return we(()=>{const r=new je(-1e7,-1e6);let i=!1;const s=new Be;let a=null,d=null;const h=new Ne,o=new he({map:new de().load("https://photo-sphere-viewer-data.netlify.app/assets/sphere.jpg")}),m=1e3,u=new V(new Fe(m,m,m),o);u.geometry.scale(-1,1,1),h.add(u);const w=new Ge(250);h.add(w);const l=new Ve,t=new Je;t.setDecoderPath("./draco/"),l.setDRACOLoader(t),l.load("./gltf/2.gltf",f=>{const M=new B;M.add(Y);const F=new B;F.name="LFDoorGroup";const G=new B;G.name="LBDoorGroup",a=f.scene.getObjectByName("\u5DE6\u524D\u95E8"),d=f.scene.getObjectByName("\u5DE6\u540E\u95E8");const v=ae(a);v.name="LFSprite",v.position.x+=340,v.position.y+=-70,v.position.z+=-80,F.add(v);const L=ae(d);L.name="LBSprite",L.position.x+=200,L.position.y+=-100,L.position.z+=-70,G.add(L);let x=0;function Q(){x+=.01,x<.5?(v.scale.x=30*(1+x),v.scale.y=30*(1+x),L.scale.x=30*(1+x),L.scale.y=30*(1+x)):x>=.5&&x<1?(v.scale.x=30*(2-x),v.scale.y=30*(2-x),L.scale.x=30*(2-x),L.scale.y=30*(2-x)):x=0,requestAnimationFrame(Q)}Q();const X=n.value?"visible":"hidden",U=document.getElementsByClassName("mark")[0];U.style.visibility=X;const T=new N(U);U.style.pointerEvents="none",T.position.copy(v.position),T.scale.set(.5,.5,1),T.position.set(0,0,0),T.position.x-=220,T.position.y+=50,T.rotateY(-Math.PI/2),M.add(T);const W=document.getElementsByClassName("mark")[1];W.style.visibility=X;const P=new N(W);W.style.pointerEvents="none",P.position.copy(v.position),P.scale.set(.5,.5,1),P.position.set(0,0,0),P.position.z-=120,P.position.y+=50,P.rotateY(Math.PI),M.add(P),a.add(F),d.add(G),M.add(f.scene),h.add(M)},f=>{e.value=+(f.loaded/f.total*100).toFixed(0),console.log(f)},f=>{console.log({err:f})});const p=new oe(16777215,.8);p.position.set(400,200,300),h.add(p);const _=new oe(16777215,.8);_.position.set(-400,-200,-300),h.add(_);const g=new Ue(16777215,2.9);h.add(g);const b=new We(16777215);b.position.set(400,200,300),h.add(b);const k=window.innerWidth,E=window.innerHeight,I=k/E,R=200,C=new He(-R*I,R*I,R,-R,1,3e3);C.position.set(292,223,185),C.lookAt(h.position);const A=new ze({antialias:!0});A.setSize(k,E),A.setClearColor(65535,1);const Z=document.getElementById("car");Z&&Z.appendChild(A.domElement);const me=f=>{i=!0,f.preventDefault(),r.x=f.clientX/window.innerWidth*2-1,r.y=-(f.clientY/window.innerHeight)*2+1},fe=()=>{A.setSize(window.innerWidth,window.innerHeight),C.aspect=window.innerWidth/(window.innerHeight-50),C.updateProjectionMatrix()};document.addEventListener("click",me,!1),window.addEventListener("resize",fe,!1);const D=new et;D.setSize(window.innerWidth,window.innerHeight),D.domElement.style.position="absolute",D.domElement.style.top="0px",D.domElement.style.left="0px",D.domElement.style.pointerEvents="none",document.body.appendChild(D.domElement);const J=()=>{if(h.children[6]){s.setFromCamera(r,C);const f=s.intersectObject(h.children[6],!0);f[0]&&i&&(console.log("intersects",f[0]),(f[0].object.parent.name==="\u5DE6\u524D\u95E8"||f[0].object.name==="LFSprite")&&(a.flag?(a.rotateY(Math.sin(Math.PI/2)),a.flag=!1):(a.rotateY(-Math.sin(Math.PI/2)),a.flag=!0)),(f[0].object.parent.name==="\u5DE6\u540E\u95E8"||f[0].object.name==="LBSprite")&&(d.flag?(d.rotateY(Math.sin(Math.PI/2)),d.flag=!1):(d.rotateY(-Math.sin(Math.PI/2)),d.flag=!0)),i=!1)}h.rotateY(5e-4),D.render(h,C),A.render(h,C),requestAnimationFrame(J)};J();const O=new Ye(C,A.domElement);O.minZoom=.5,O.maxZoom=1,O.maxPolarAngle=Math.PI/2,O.minPolarAngle=0;const K=new qe.exports.Viewer({container:document.querySelector("#photosphere"),panorama:"./panorama/car2.jpg",size:{width:window.innerWidth,height:window.innerHeight},defaultLat:-Math.PI/2,defaultLong:-Math.PI,defaultZoomLvl:0,fisheye:2,navbar:!1});K.once("ready",()=>{K.animate({longitude:0,latitude:0,zoom:50,speed:"4rpm"})})}),ge(()=>{const r=document.getElementsByClassName("mark");for(let i=0;i<r.length;i++)r[i].style.visibility="hidden"}),(r,i)=>{const s=be("el-button");return _e(),xe("div",at,[lt,ee(ne("div",ct,null,512),[[te,n.value]]),ee(ne("div",dt,null,512),[[te,!n.value]]),ve(s,{onClick:c,class:"switch"},{default:ke(()=>[ht]),_:1})])}}};var gt=Ze(pt,[["__scopeId","data-v-cd93a212"]]);export{gt as default};
//# sourceMappingURL=Model.d0c56f00.js.map
