import{f as X,g as fe,h as ye,r as we,o as ge,c as be,w as $,v as ee,j as te,a as _e,k as xe,l as ve,m as ke}from"./vendor.432cbb82.js";import{L as ae,F as z,B as Se,a as ne,V as q,Q as Ce,O as Le,M as le,S as De,T as ce,b as Te,c as Ae,C as Ee,d as de,e as V,G as B,f as Pe,D as Me,g as Ie,R as Re,h as Oe,i as Be,A as Ne,j as se,k as Fe,P as Ue,l as Ge,W as We,m as He}from"./three.module.4e473ec6.js";import{p as ze}from"./photo-sphere-viewer.cd7e4c7d.js";import{G as je,O as qe}from"./GLTFLoader.1dc520eb.js";import{_ as Ve}from"./index.84e4b379.js";const H=new WeakMap;class Ye extends ae{constructor(e){super(e);this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,c,o){const i=new z(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,s=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(s,a).then(n).catch(o)},c,o)}decodeDracoFile(e,n,c,o){const i={attributeIDs:c||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!c};this.decodeGeometry(e,i).then(n)}decodeGeometry(e,n){for(const d in n.attributeTypes){const h=n.attributeTypes[d];h.BYTES_PER_ELEMENT!==void 0&&(n.attributeTypes[d]=h.name)}const c=JSON.stringify(n);if(H.has(e)){const d=H.get(e);if(d.key===c)return d.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let o;const i=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(i,s).then(d=>(o=d,new Promise((h,r)=>{o._callbacks[i]={resolve:h,reject:r},o.postMessage({type:"decode",id:i,taskConfig:n,buffer:e},[e])}))).then(d=>this._createGeometry(d.geometry));return a.catch(()=>!0).then(()=>{o&&i&&this._releaseTask(o,i)}),H.set(e,{key:c,promise:a}),a}_createGeometry(e){const n=new Se;e.index&&n.setIndex(new ne(e.index.array,1));for(let c=0;c<e.attributes.length;c++){const o=e.attributes[c],i=o.name,s=o.array,a=o.itemSize;n.setAttribute(i,new ne(s,a))}return n}_loadLibrary(e,n){const c=new z(this.manager);return c.setPath(this.decoderPath),c.setResponseType(n),c.setWithCredentials(this.withCredentials),new Promise((o,i)=>{c.load(e,o,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(c=>{const o=c[0];e||(this.decoderConfig.wasmBinary=c[1]);const i=Ze.toString(),s=["/* draco decoder */",o,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const o=new Worker(this.workerSourceURL);o._callbacks={},o._taskCosts={},o._taskLoad=0,o.postMessage({type:"init",decoderConfig:this.decoderConfig}),o.onmessage=function(i){const s=i.data;switch(s.type){case"decode":o._callbacks[s.id].resolve(s);break;case"error":o._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(o)}else this.workerPool.sort(function(o,i){return o._taskLoad>i._taskLoad?-1:1});const c=this.workerPool[this.workerPool.length-1];return c._taskCosts[e]=n,c._taskLoad+=n,c})}_releaseTask(e,n){e._taskLoad-=e._taskCosts[n],delete e._callbacks[n],delete e._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function Ze(){let y,e;onmessage=function(s){const a=s.data;switch(a.type){case"init":y=a.decoderConfig,e=new Promise(function(r){y.onModuleLoaded=function(m){r({draco:m})},DracoDecoderModule(y)});break;case"decode":const d=a.buffer,h=a.taskConfig;e.then(r=>{const m=r.draco,u=new m.Decoder,w=new m.DecoderBuffer;w.Init(new Int8Array(d),d.byteLength);try{const l=n(m,u,w,h),t=l.attributes.map(p=>p.array.buffer);l.index&&t.push(l.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:l},t)}catch(l){console.error(l),self.postMessage({type:"error",id:a.id,error:l.message})}finally{m.destroy(w),m.destroy(u)}});break}};function n(s,a,d,h){const r=h.attributeIDs,m=h.attributeTypes;let u,w;const l=a.GetEncodedGeometryType(d);if(l===s.TRIANGULAR_MESH)u=new s.Mesh,w=a.DecodeBufferToMesh(d,u);else if(l===s.POINT_CLOUD)u=new s.PointCloud,w=a.DecodeBufferToPointCloud(d,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!w.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+w.error_msg());const t={index:null,attributes:[]};for(const p in r){const _=self[m[p]];let g,b;if(h.useUniqueIDs)b=r[p],g=a.GetAttributeByUniqueId(u,b);else{if(b=a.GetAttributeId(u,s[r[p]]),b===-1)continue;g=a.GetAttribute(u,b)}t.attributes.push(o(s,a,u,p,_,g))}return l===s.TRIANGULAR_MESH&&(t.index=c(s,a,u)),s.destroy(u),t}function c(s,a,d){const r=d.num_faces()*3,m=r*4,u=s._malloc(m);a.GetTrianglesUInt32Array(d,m,u);const w=new Uint32Array(s.HEAPF32.buffer,u,r).slice();return s._free(u),{array:w,itemSize:1}}function o(s,a,d,h,r,m){const u=m.num_components(),l=d.num_points()*u,t=l*r.BYTES_PER_ELEMENT,p=i(s,r),_=s._malloc(t);a.GetAttributeDataArrayForAllPoints(d,m,p,t,_);const g=new r(s.HEAPF32.buffer,_,l).slice();return s._free(_),{name:h,array:g,itemSize:u}}function i(s,a){switch(a){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32}}}const oe=new q,Je=new Ce,re=new q;class N extends Le{constructor(e=document.createElement("div")){super();this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(n){n.element instanceof Element&&n.element.parentNode!==null&&n.element.parentNode.removeChild(n.element)})})}copy(e,n){return super.copy(e,n),this.element=e.element.cloneNode(!0),this}}N.prototype.isCSS3DObject=!0;class Ke extends N{constructor(e){super(e);this.rotation2D=0}copy(e,n){return super.copy(e,n),this.rotation2D=e.rotation2D,this}}Ke.prototype.isCSS3DSprite=!0;const S=new le,Qe=new le;class Xe{constructor(e={}){const n=this;let c,o,i,s;const a={camera:{fov:0,style:""},objects:new WeakMap},d=e.element!==void 0?e.element:document.createElement("div");d.style.overflow="hidden",this.domElement=d;const h=document.createElement("div");h.style.transformStyle="preserve-3d",h.style.pointerEvents="none",d.appendChild(h),this.getSize=function(){return{width:c,height:o}},this.render=function(l,t){const p=t.projectionMatrix.elements[5]*s;a.camera.fov!==p&&(d.style.perspective=t.isPerspectiveCamera?p+"px":"",a.camera.fov=p),l.autoUpdate===!0&&l.updateMatrixWorld(),t.parent===null&&t.updateMatrixWorld();let _,g;t.isOrthographicCamera&&(_=-(t.right+t.left)/2,g=(t.top+t.bottom)/2);const k=(t.isOrthographicCamera?"scale("+p+")translate("+r(_)+"px,"+r(g)+"px)"+m(t.matrixWorldInverse):"translateZ("+p+"px)"+m(t.matrixWorldInverse))+"translate("+i+"px,"+s+"px)";a.camera.style!==k&&(h.style.transform=k,a.camera.style=k),w(l,l,t)},this.setSize=function(l,t){c=l,o=t,i=c/2,s=o/2,d.style.width=l+"px",d.style.height=t+"px",h.style.width=l+"px",h.style.height=t+"px"};function r(l){return Math.abs(l)<1e-10?0:l}function m(l){const t=l.elements;return"matrix3d("+r(t[0])+","+r(-t[1])+","+r(t[2])+","+r(t[3])+","+r(t[4])+","+r(-t[5])+","+r(t[6])+","+r(t[7])+","+r(t[8])+","+r(-t[9])+","+r(t[10])+","+r(t[11])+","+r(t[12])+","+r(-t[13])+","+r(t[14])+","+r(t[15])+")"}function u(l){const t=l.elements,p="matrix3d("+r(t[0])+","+r(t[1])+","+r(t[2])+","+r(t[3])+","+r(-t[4])+","+r(-t[5])+","+r(-t[6])+","+r(-t[7])+","+r(t[8])+","+r(t[9])+","+r(t[10])+","+r(t[11])+","+r(t[12])+","+r(t[13])+","+r(t[14])+","+r(t[15])+")";return"translate(-50%,-50%)"+p}function w(l,t,p,_){if(l.isCSS3DObject){const g=l.visible===!0&&l.layers.test(p.layers)===!0;if(l.element.style.display=g===!0?"":"none",g===!0){l.onBeforeRender(n,t,p);let b;l.isCSS3DSprite?(S.copy(p.matrixWorldInverse),S.transpose(),l.rotation2D!==0&&S.multiply(Qe.makeRotationZ(l.rotation2D)),l.matrixWorld.decompose(oe,Je,re),S.setPosition(oe),S.scale(re),S.elements[3]=0,S.elements[7]=0,S.elements[11]=0,S.elements[15]=1,b=u(S)):b=u(l.matrixWorld);const k=l.element,P=a.objects.get(l);if(P===void 0||P.style!==b){k.style.transform=b;const I={style:b};a.objects.set(l,I)}k.parentNode!==h&&h.appendChild(k),l.onAfterRender(n,t,p)}}for(let g=0,b=l.children.length;g<b;g++)w(l.children[g],t,p)}}}function ie(y){const e=new De({map:new ce().load("./mark/light-point.png"),transparent:!0}),n=new Te(e);n.scale.set(30,30,1);const c=new q;return y.getWorldPosition(c),n.position.copy(c),n}class $e extends ae{constructor(e){super(e)}load(e,n,c,o){const i=this,s=new z(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,function(a){let d;try{d=JSON.parse(a)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),d=JSON.parse(a.substring(65,a.length-2))}const h=i.parse(d);n&&n(h)},c,o)}parse(e){return new he(e)}}class he{constructor(e){this.type="Font",this.data=e}generateShapes(e,n=100){const c=[],o=et(e,n,this.data);for(let i=0,s=o.length;i<s;i++)Array.prototype.push.apply(c,o[i].toShapes());return c}}function et(y,e,n){const c=Array.from(y),o=e/n.resolution,i=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,s=[];let a=0,d=0;for(let h=0;h<c.length;h++){const r=c[h];if(r===`
`)a=0,d-=i;else{const m=tt(r,o,a,d,n);a+=m.offsetX,s.push(m.path)}}return s}function tt(y,e,n,c,o){const i=o.glyphs[y]||o.glyphs["?"];if(!i){console.error('THREE.Font: character "'+y+'" does not exists in font family '+o.familyName+".");return}const s=new Ae;let a,d,h,r,m,u,w,l;if(i.o){const t=i._cachedOutline||(i._cachedOutline=i.o.split(" "));for(let p=0,_=t.length;p<_;)switch(t[p++]){case"m":a=t[p++]*e+n,d=t[p++]*e+c,s.moveTo(a,d);break;case"l":a=t[p++]*e+n,d=t[p++]*e+c,s.lineTo(a,d);break;case"q":h=t[p++]*e+n,r=t[p++]*e+c,m=t[p++]*e+n,u=t[p++]*e+c,s.quadraticCurveTo(m,u,h,r);break;case"b":h=t[p++]*e+n,r=t[p++]*e+c,m=t[p++]*e+n,u=t[p++]*e+c,w=t[p++]*e+n,l=t[p++]*e+c,s.bezierCurveTo(m,u,w,l,h,r);break}}return{offsetX:i.ha*e,path:s}}he.prototype.isFont=!0;const j=250,nt=new Ee(j,j,10,128),st=new de({color:4372867}),pe=new V(nt,st);pe.translateY(-5);const Y=new B;Y.add(pe);const ot=new $e;ot.load("./font/helvetiker_bold.typeface.json",y=>{const e=new Pe({color:16777215,side:Me}),n=y.generateShapes("LEXUS UX300E",30),c=new Ie(n),o=new V(c,e);o.position.z=j,o.position.x=-120,Y.add(o)});const rt={id:"BYD"},it=ve('<div class="mark" data-v-87d9e53a><div class="des" data-v-87d9e53a><div class="title" data-v-87d9e53a>\u524D\u8138\u8BBE\u8BA1</div><div class="text" data-v-87d9e53a>\u524D\u8138\u7EBA\u9524\u5F0F\u7684\u4E2D\u7F51\u683C\u6805\u8BBE\u8BA1</div><div class="text" data-v-87d9e53a>\u642D\u914D\u4E24\u4FA7\u72ED\u957F\u7280\u5229\u7684\u5927\u706F\u9020\u578B</div></div></div><div class="mark" data-v-87d9e53a><div class="des" data-v-87d9e53a><div class="text" data-v-87d9e53a>\u5168\u65B0\u6DF7\u52A8\u79D1\u6280\uFF0CFYRA\u56DB\u9A71\u52A8\u529B\u7CFB\u7EDF</div></div></div>',2),at={id:"car"},lt={id:"photosphere"},ct=ke("\u5207\u6362"),dt={setup(y){const e=X(100),n=X(!1),c=()=>{n.value=!n.value;const o=document.getElementsByClassName("mark");for(let i=0;i<o.length;i++)o[i].style.visibility=n.value?"visible":"hidden"};return fe(()=>{const o=new He(-1e7,-1e6);let i=!1;const s=new Re;let a=null,d=null;const h=new Oe,r=new de({map:new ce().load("https://photo-sphere-viewer-data.netlify.app/assets/sphere.jpg")}),m=1e3,u=new V(new Be(m,m,m),r);u.geometry.scale(-1,1,1),h.add(u);const w=new Ne(250);h.add(w);const l=new je,t=new Ye;t.setDecoderPath("./draco/"),l.setDRACOLoader(t),l.load("./gltf/2.gltf",f=>{const M=new B;M.add(Y);const F=new B;F.name="LFDoorGroup";const U=new B;U.name="LBDoorGroup",a=f.scene.getObjectByName("\u5DE6\u524D\u95E8"),d=f.scene.getObjectByName("\u5DE6\u540E\u95E8");const v=ie(a);v.name="LFSprite",v.position.x+=340,v.position.y+=-70,v.position.z+=-80,F.add(v);const C=ie(d);C.name="LBSprite",C.position.x+=200,C.position.y+=-100,C.position.z+=-70,U.add(C);let x=0;function Q(){x+=.01,x<.5?(v.scale.x=30*(1+x),v.scale.y=30*(1+x),C.scale.x=30*(1+x),C.scale.y=30*(1+x)):x>=.5&&x<1?(v.scale.x=30*(2-x),v.scale.y=30*(2-x),C.scale.x=30*(2-x),C.scale.y=30*(2-x)):x=0,requestAnimationFrame(Q)}Q();const G=document.getElementsByClassName("mark")[0];G.style.visibility="visible";const T=new N(G);G.style.pointerEvents="none",T.position.copy(v.position),T.scale.set(.5,.5,1),T.position.set(0,0,0),T.position.x-=220,T.position.y+=50,T.rotateY(-Math.PI/2),M.add(T);const W=document.getElementsByClassName("mark")[1];W.style.visibility="visible";const A=new N(W);W.style.pointerEvents="none",A.position.copy(v.position),A.scale.set(.5,.5,1),A.position.set(0,0,0),A.position.z-=120,A.position.y+=50,A.rotateY(Math.PI),M.add(A),a.add(F),d.add(U),M.add(f.scene),h.add(M)},f=>{e.value=+(f.loaded/f.total*100).toFixed(0),console.log(f)},f=>{console.log({err:f})});const p=new se(16777215,.8);p.position.set(400,200,300),h.add(p);const _=new se(16777215,.8);_.position.set(-400,-200,-300),h.add(_);const g=new Fe(16777215,2.9);h.add(g);const b=new Ue(16777215);b.position.set(400,200,300),h.add(b);const k=window.innerWidth,P=window.innerHeight,I=k/P,R=200,L=new Ge(-R*I,R*I,R,-R,1,3e3);L.position.set(292,223,185),L.lookAt(h.position);const E=new We({antialias:!0});E.setSize(k,P),E.setClearColor(65535,1);const Z=document.getElementById("car");Z&&Z.appendChild(E.domElement);const ue=f=>{i=!0,f.preventDefault(),o.x=f.clientX/window.innerWidth*2-1,o.y=-(f.clientY/window.innerHeight)*2+1},me=()=>{E.setSize(window.innerWidth,window.innerHeight),L.aspect=window.innerWidth/(window.innerHeight-50),L.updateProjectionMatrix()};document.addEventListener("click",ue,!1),window.addEventListener("resize",me,!1);const D=new Xe;D.setSize(window.innerWidth,window.innerHeight),D.domElement.style.position="absolute",D.domElement.style.top="0px",D.domElement.style.left="0px",D.domElement.style.pointerEvents="none",document.body.appendChild(D.domElement);const J=()=>{if(h.children[6]){s.setFromCamera(o,L);const f=s.intersectObject(h.children[6],!0);f[0]&&i&&(console.log("intersects",f[0]),(f[0].object.parent.name==="\u5DE6\u524D\u95E8"||f[0].object.name==="LFSprite")&&(a.flag?(a.rotateY(Math.sin(Math.PI/2)),a.flag=!1):(a.rotateY(-Math.sin(Math.PI/2)),a.flag=!0)),(f[0].object.parent.name==="\u5DE6\u540E\u95E8"||f[0].object.name==="LBSprite")&&(d.flag?(d.rotateY(Math.sin(Math.PI/2)),d.flag=!1):(d.rotateY(-Math.sin(Math.PI/2)),d.flag=!0)),i=!1)}h.rotateY(5e-4),D.render(h,L),E.render(h,L),requestAnimationFrame(J)};J();const O=new qe(L,E.domElement);O.minZoom=.5,O.maxZoom=1,O.maxPolarAngle=Math.PI/2,O.minPolarAngle=0;const K=new ze.exports.Viewer({container:document.querySelector("#photosphere"),panorama:"./panorama/car2.jpg",size:{width:window.innerWidth,height:window.innerHeight},defaultZoomLvl:10,navbar:!1});K.once("ready",()=>{K.animate({longitude:Math.PI,latitude:"20deg",zoom:50,speed:"2rpm"})})}),ye(()=>{const o=document.getElementsByClassName("mark");for(let i=0;i<o.length;i++)o[i].style.visibility="hidden";console.log("onBeforeUnmount")}),(o,i)=>{const s=we("el-button");return ge(),be("div",rt,[it,$(te("div",at,null,512),[[ee,n.value]]),$(te("div",lt,null,512),[[ee,!n.value]]),_e(s,{onClick:c,class:"switch"},{default:xe(()=>[ct]),_:1})])}}};var yt=Ve(dt,[["__scopeId","data-v-87d9e53a"]]);export{yt as default};
//# sourceMappingURL=Model.aed3e9f6.js.map
